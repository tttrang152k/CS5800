<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Invoices</title>
    <style>
        body { margin:0; background:#fafafa; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
        .container { max-width:1100px; margin:24px auto 56px; padding:0 16px; }
        .toolbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
        .btn, a.btn, button.btn {
            display:inline-flex; align-items:center; justify-content:center;
            padding:8px 12px; border:1px solid #ddd; border-radius:8px;
            background:#fff; color:#111; text-decoration:none; cursor:pointer;
            font:inherit; line-height:1.2; min-height:32px;
        }
        .btn.small, a.btn.small, button.btn.small { padding:6px 10px; min-height:30px; }
        .btn:disabled, button.btn:disabled { opacity:.6; cursor:not-allowed; }
        button.btn { -webkit-appearance:none; appearance:none; }
        .muted { color:#777; }
        .alert { margin:12px 0; padding:10px 12px; border:1px solid #c7f3d4; background:#f2fff6; border-radius:8px; color:#0f5132; }
        .card { background:#fff; border:1px solid #eee; border-radius:10px; padding:14px; }
        .form-grid {
            display:grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px 16px;
            align-items:end;
        }
        @media (max-width: 900px) {
            .form-grid { grid-template-columns: 1fr; }
        }
        .form-item label {
            display:block; margin-bottom:6px; color:#444; font-weight:600; font-size:.95rem;
        }
        .form-item select,
        .form-item input {
            width:100%;
            padding:8px;
            border:1px solid #ddd;
            border-radius:8px;
            background:#fff;
            font:inherit;
        }
        .form-actions {
            grid-column: 1 / -1;
            display:flex; justify-content:flex-end;
            margin-top:4px;
        }
        .form-grid.one-col {
            grid-template-columns: 1fr;
        }
        .form-item.narrow {
            width: min(100%, 420px);
        }
        .form-item.narrow select,
        .form-item.narrow input {
            width: 100%;
            box-sizing: border-box;
        }
        table { width:100%; border-collapse:collapse; background:#fff; border:1px solid #eee; border-radius:10px; overflow:hidden; margin-top:12px; }
        thead th { background:#f8f9fa; position:sticky; top:0; z-index:1; }
        th, td { padding:10px 8px; border-bottom:1px solid #f0f0f0; text-align:left; }
        tbody tr:hover { background:#fbfbfb; }
        .num { text-align:right; white-space:nowrap; }

        a.rowlink { text-decoration:none; color:#0a58ca; }
        a.rowlink:hover { text-decoration:underline; }
    </style>
</head>
<body>
<div class="container">

    <div class="toolbar">
        <h2>Invoices</h2>
        <a class="btn" href="/loads">Loads</a>
    </div>

    <p th:if="${toast}" class="alert" th:text="${toast}">Saved.</p>

    <h3>Create Invoice from Delivered Load</h3>
    <form th:action="@{/invoices}" method="post" class="card">
        <div class="form-grid one-col">
            <div class="form-item narrow">
                <label for="loadId">Delivered Load</label>
                <select id="loadId" name="loadId" required>
                    <option th:each="l : ${deliveredLoads}"
                            th:value="${l.id}"
                            th:text="${l.id + ' — ' + (l.referenceNo != null ? l.referenceNo : '')}">
                        L-100 — ACME
                    </option>
                </select>
            </div>

            <div class="form-item narrow">
                <label for="amount">Additional Charges</label>
                <input id="amount" type="number" step="0.01" name="amount" placeholder="e.g. Lumper fee"/>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn">Create Invoice</button>
            </div>
        </div>
    </form>

    <h3 style="margin-top:24px;">All Invoices</h3>
    <table>
        <thead>
        <tr>
            <th style="width:120px;">Invoice</th>
            <th style="width:110px;">Load</th>
            <th>Customer</th>
            <th style="width:170px;">Issued</th>
            <th style="width:110px;">Status</th>
            <th class="num" style="width:110px;">Subtotal</th>
            <th class="num" style="width:90px;">Tax</th>
            <th class="num" style="width:110px;">Total</th>
            <th class="num" style="width:110px;">Paid</th>
            <th class="num" style="width:110px;">Balance</th>
            <th style="width:210px;">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="r : ${rows}">
            <td th:text="${r.inv.id}">INV-000001</td>
            <td>
                <a class="rowlink" th:href="@{'/loads/' + ${r.inv.loadId}}"
                   th:text="${r.inv.loadId}">L-101</a>
            </td>
            <td>
                <a class="rowlink" th:href="@{'/customers/' + ${r.inv.customerRef}}"
                   th:text="${r.inv.customerRef}">Acme</a>
            </td>
            <td th:text="${r.inv.issuedAt}">2025-10-07T10:15</td>
            <td th:text="${r.inv.status}">Draft</td>
            <td class="num" th:text="${#numbers.formatDecimal(r.inv.subtotal,1,'COMMA',2,'POINT')}">0.00</td>
            <td class="num" th:text="${#numbers.formatDecimal(r.inv.tax,1,'COMMA',2,'POINT')}">0.00</td>
            <td class="num" th:text="${#numbers.formatDecimal(r.inv.total,1,'COMMA',2,'POINT')}">0.00</td>
            <td class="num" th:text="${#numbers.formatDecimal(r.paid,1,'COMMA',2,'POINT')}">0.00</td>
            <td class="num" th:text="${#numbers.formatDecimal(r.balance,1,'COMMA',2,'POINT')}">0.00</td>
            <td>
                <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                    <form class="inline"
                          th:action="@{'/invoices/' + ${r.inv.id} + '/send'}"
                          method="post"
                          th:if="${r.inv.status == 'Draft'}">
                        <button type="submit" class="btn small">Mark Sent</button>
                    </form>
                    <a class="btn small"
                       th:if="${r.balance > 0}"
                       th:href="@{'/invoices/' + ${r.inv.id} + '/pay'}">Make Payment</a>
                    <span th:if="${r.balance <= 0}" class="muted">Paid</span>
                </div>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(rows)}">
            <td colspan="11" class="muted" style="text-align:center; padding:16px;">
                No invoices yet.
            </td>
        </tr>
        </tbody>
    </table>

</div>
</body>
</html>
